import{B as e}from"./esm-chunk-d81494b9.js";import{findParentBySelector as t,getParentByClassName as o,getDocumentScrollTop as n,getDocumentScrollLeft as l,elementIsInDOM as i,querySelectorFromRoot as r,ensureElement as s,getLeftRightBordersAndPaddingsSummaryValue as c,getCurrentStyleSheet as u,subscribeElementContentSize as a,removeSelection as d,getTopBottomBordersAndPaddingsSummaryValue as f,unsubscribeElement as p}from"./esm-dom-utils-c40cd314.js";import{a as g,d as h,i as m,g as y}from"./esm-chunk-9c16a801.js";import{d as H,r as S}from"./esm-chunk-f3c18c5b.js";import{T as x}from"./esm-chunk-1b6abd73.js";import"./esm-chunk-808bf349.js";import{g as b}from"./esm-chunk-13e2cf5f.js";import{minColumnWidth as T,ColumnResizeMode as w}from"./esm-grid-column-resize-adeb3acf.js";const v=".dxbs-table td.table-active",I=".dropdown-item.active",R=".dropdown-item.focused",E={GroupPanelHead:"gph",ColumnHead:"ch"};function q(e){if(!e.hasAttribute("data-dxdg-draggable-id"))return null;const t=e.getAttribute("data-dxdg-column-id").split("|"),o=!(t.length>2)||"1"===t[2],n=t.length>1?E[t[1]]:E.ColumnHead,l=n===E.ColumnHead?parseInt(t[0]):-1,i=n===E.GroupPanelHead?parseInt(t[0]):-1,r=e.previousElementSibling;return{columnVisibleIndex:l,groupVisibleIndex:i,columnHeadType:n,canBeGrouped:o,needInsertBeforeToo:!r||!q(r),element:e}}function N(e){return"[data-dxdg-draggable-id="+e+"]"}function B(e,t,o){var n,l,i;n=e,l=M(t,"clientX")-o.left,i=M(t,"clientY")-o.top,void(n.style.transform=["translate(",Math.round(l),"px, ",Math.round(i),"px)"].join(""))}function M(e,t){return void 0!==e[t]?e[t]:void 0!==e.touches?e.touches[0][t]:0}function V(i,r,s,c){const u=M(i,"clientX"),a=M(i,"clientY"),d=i.target;if(s){const e=t(i.target,"th");if(e&&u>=e.getBoundingClientRect().right-T)return}let f=!1;const p=function(e){const i=Math.abs(u-M(e,"clientX"))>10,s=Math.abs(a-M(e,"clientY"))>10;return(i||s)&&(f=!0,m(),function(e,i,r,s){const c=N(r),u=t(i,c);if(!u)return;const a=o(u,"dxbs-gridview").getBoundingClientRect(),d=q(u),f=l(),p=n();let m={left:0,top:0};const y=function(e,t){const o=[],n=N(t),l=document.querySelectorAll(n);let i=!1,r=!1;for(let e=0;e<l.length;e++){const t=l[e],n=t.getBoundingClientRect(),s=q(t),c=s.columnVisibleIndex,u=s.groupVisibleIndex,a=s.columnHeadType;a===E.GroupPanelHead?i=!0:a===E.ColumnHead&&(r=!0),s.needInsertBeforeToo&&o.push(new C(t,n.left,n.top,n.bottom,c,u,a,!0,!1)),o.push(new C(t,n.right,n.top,n.bottom,c,u,a,!1,!1))}if(i||r){if(!i){const e=document.querySelector("[data-dxdg-drag-group-panel="+t+"]");if(e){const t=e.getBoundingClientRect();o.push(new C(e,t.left,t.top,t.bottom,-1,0,E.GroupPanelHead,!1,!0,!0))}}if(!r){const e=document.querySelector("[data-dxdg-drag-head-row="+t+"]");if(e){const t=e.getBoundingClientRect();o.push(new C(e,t.right,t.top,t.bottom,-1,-1,E.ColumnHead,!1,!0,!0))}}}return o}(0,r),H=function(e,t){let o=e.cloneNode(!0);const n=e.getBoundingClientRect(),l={left:M(t,"clientX")-n.left,top:M(t,"clientY")-n.top};if("DIV"!==o.tagName){const t=document.createElement("DIV"),l=window.getComputedStyle(e);t.innerHTML=o.innerHTML,t.className="card "+e.className,t.style.width=n.width+"px",t.style.height=n.height+"px",t.style.paddingTop=l.paddingTop,t.style.paddingBottom=l.paddingBottom,t.style.paddingLeft=l.paddingLeft,t.style.paddingRight=l.paddingRight,o=t}else o.style.width=n.width+"px",o.style.height=n.height+"px";o.className=o.className+" dx-dragging-state",document.body.appendChild(o);const i=o.getBoundingClientRect();return{dragElement:o,offsetFromMouse:{left:i.left+l.left,top:i.top+l.top}}}(u,e),S=H.dragElement,b=H.offsetFromMouse;B(S,e,b);let T=!0,w=null;const v=function(e){T&&(S.style.visibility="visible",T=!1);return B(S,e,{left:b.left+m.left,top:b.top+m.top}),w=function(e,t,o,i,r,s){!function(e){const t=N(e),o=document.querySelectorAll("div.dxgv-target-marks"+t);for(let e=0;e<o.length;e++){const t=o[e];t.parentNode.removeChild(t)}}(t);let c=null;const u=[],a=M(i,"clientX"),d=M(i,"clientY");for(let t=0;t<e.length;t++){const n=e[t];if(n.columnHeadType===E.GroupPanelHead&&!o.canBeGrouped)continue;if(n.top+r.top<=d&&d<=n.bottom+r.top){if(n.wholeRowIsRarget){c=n;break}u.push({distance:Math.abs(Math.abs(n.x+r.left)-Math.abs(a)),target:n})}}if(null==c){let e=1e6;for(const t in u)e>u[t].distance&&D(a,o,u[t].target)&&(e=u[t].distance,c=u[t].target)}null==c||L(o,c)||c.x>=s.left&&c.x<=s.right&&!function(e,t){const o=document.createElement("DIV");o.className="dxgv-target-marks",o.dataset.dxdgDraggableId=t,o.style.top=e.top+(e.docScrollTop-n())+n()-1-1+"px",o.style.height=e.bottom-e.top+2+"px",o.style.left=e.x+(e.docScrollLeft-l())+l()+"px",o.innerHTML=["<span class='oi oi-arrow-bottom' aria-hidden='true'></span>","<div style='height:",o.style.height,"'></div>","<span class='oi oi-arrow-top' aria-hidden='true'></span>"].join(""),document.body.appendChild(o),e.mark=o}(c,t);return c}(y,r,d,e,m,a),e.preventDefault(),!1},I=function(){if(w&&!L(d,w)){s.invokeMethodAsync("OnGridColumnHeadDragNDrop",d.columnHeadType===E.GroupPanelHead?d.groupVisibleIndex:d.columnVisibleIndex,d.columnHeadType,w.columnHeadType===E.GroupPanelHead?w.groupVisibleIndex:w.columnVisibleIndex,w.columnHeadType,w.insertBefore),w.mark&&w.mark.parentNode.removeChild(w.mark)}h(document,x.touchMouseMoveEventName,v),h(document,x.touchMouseUpEventName,I),h(window,"scroll",R),S.parentNode.removeChild(S)},R=function(){m={left:f-l(),top:p-n()}};g(document,x.touchMouseMoveEventName,v),g(document,x.touchMouseUpEventName,I),g(window,"scroll",R)}(e,d,r,c)),e.preventDefault(),!1},m=function(){h(document,x.touchMouseMoveEventName,p),h(document,x.touchMouseUpEventName,m),!f&&d&&e.WebKitTouchUI&&d.click()};return g(document,x.touchMouseMoveEventName,p),g(document,x.touchMouseUpEventName,m),i.preventDefault(),d.focus(),!1}function C(e,t,o,i,r,s,c,u,a){this.element=e,this.x=t,this.top=o,this.bottom=i,this.columnVisibleIndex=r,this.groupVisibleIndex=s,this.columnHeadType=c,this.insertBefore=u,this.wholeRowIsRarget=a,this.docScrollTop=n(),this.docScrollLeft=l()}function L(e,t){function o(e,t){return t.groupVisibleIndex===e.groupVisibleIndex||t.groupVisibleIndex===e.groupVisibleIndex-1&&!t.insertBefore}function n(e,t){return t.columnVisibleIndex===e.columnVisibleIndex||t.columnVisibleIndex===e.columnVisibleIndex-1&&!t.insertBefore}if(t.columnHeadType===e.columnHeadType&&e.columnHeadType===E.GroupPanelHead&&o(e,t))return!0;if(t.columnHeadType===e.columnHeadType&&e.columnHeadType===E.ColumnHead&&n(e,t))return!0;if(e.columnHeadType===E.GroupPanelHead&&t.columnHeadType===E.ColumnHead&&-1!==e.columnVisibleIndex&&n(e,t))return!0;return!(e.columnHeadType!==E.ColumnHead||t.columnHeadType!==E.GroupPanelHead||-1===e.groupVisibleIndex||!o(e,t))}function D(e,t,o){const n=t.element.getBoundingClientRect();if(L(t,o)&&(e<n.left||e>n.right))return!1;if(o.x<n.left){if(e>n.right)return!1}else if(e<n.left)return!1;return!0}E[1]=E.ColumnHead,E[0]=E.GroupPanelHead;class k{constructor(e,t,o){this._itemHeight=e,this._scrollTop=t,this._scrollHeight=o}get itemHeight(){return this._itemHeight}get scrollTop(){return this._scrollTop}get scrollHeight(){return this._scrollHeight}isEqual(e){return this.itemHeight===e.itemHeight&&this.scrollTop===e.scrollTop&&this.scrollHeight===e.scrollHeight}}function A(e){if(!i(e))return;let t=function(e){let t=e.querySelector("*[id$='_LB']");t||(t=e.parentNode.querySelector("*[id$='_LB']"));t||(t=e);if(t){let e=t.querySelector(I);if(e||(e=t.querySelector(v)),e)return e.parentNode}return null}(e);if(t||(t=function(e){let t=null;r(e,(function(o){t=e.querySelector("*"+o+" > *[id$='_LB']")})),t||r(e.parentNode,(function(o){t=e.parentNode.querySelector("*"+o+" > *[id$='_LB']")}));const o=t?t.querySelector(v):null;return o?o.parentNode:null}(e)),t){const o=e;let n=t.offsetTop;if("TABLE"===t.offsetParent.tagName){const e=t.offsetParent.previousElementSibling;e&&(n+=e.clientHeight)}const l=o.scrollTop+o.clientHeight<n+t.offsetHeight;o.scrollTop>n&&(o.scrollTop=n),l&&(o.scrollTop=n-(o.clientHeight-t.offsetHeight))}}function P(e){if(!i(e))return;const t=function(e){let t=e.querySelector("*[id$='_LB']");t||(t=e.parentNode.querySelector("*[id$='_LB']"));t||(t=e);if(t){const e=t.querySelector(R);if(e)return"TR"===e.tagName?e:e.parentNode}return null}(e);if(t){let o=e.querySelector(".dxgvCSD");o||(o=e);const n=o.scrollTop+o.clientHeight<t.offsetTop+t.offsetHeight;o.scrollTop>t.offsetTop&&(o.scrollTop=t.offsetTop),n&&(o.scrollTop=t.offsetTop-(o.clientHeight-t.offsetHeight))}}function W(e){void 0===e.dataset.virtualScrollLock&&(e.dataset.virtualScrollLock=0)}function G(e){W(e),e.dataset.virtualScrollLock++}function _(e){W(e),e.dataset.virtualScrollLock--}function z(e,t,o,n,l,i,r){o.isHorizontalScrolling&&!function(e,t,o){if(t.scrollLeft===o.scrollLeft)return;const n=y(e);n===t?o.scrollLeft=t.scrollLeft:n===o&&setTimeout(()=>t.scrollLeft=o.scrollLeft,0)}(e,n,l),o.isVirtualScrolling&&function(e,t,o,n,l){if(i=o,W(i),i.dataset.virtualScrollLock>0)return;var i;!function(e,t,o,n,l){let i=!0;o.dataset.prevScrollTop?i=o.dataset.prevScrollTop!==o.scrollTop.toString():o.dataset.prevScrollTop=o.scrollTop;O(o),i&&(o.dataset.OnScrollTimerId=setTimeout((function(){!function(e,t,o,n,l){const i=X(t),r=$(t,l),s=r.scrollTop,c=r.scrollBottom,u=n.clientHeight>0&&c>o.offsetHeight+i.offsetHeight;(o.clientHeight>0&&s<o.offsetHeight||u)&&!function(e,t,o){if(e.dxScrollStateCache&&e.dxScrollStateCache.isEqual(o))return;e.dxScrollStateCache=o,t.DxRestoreScrollTop=t.scrollTop,G(t),e.invokeMethodAsync("OnGridVirtualScroll",o.itemHeight,o.scrollTop,o.scrollHeight).then(o=>{!function(e,t){ne(e.mainElement,e,t)}(o,e),_(t)}).catch(F)}(e,t,r.requestScrollState)}(e,o,n,l,!1),t.needInternalSettings&&Q(t)}),200),function(e){const t=0===e.scrollTop,o=e.scrollHeight-e.scrollTop===e.clientHeight;e.classList.remove("dx-scrolling"),t||o||e.classList.add("dx-scrolling")}(o))}(e,t,o,n,l)}(t,o,n,i,r)}function O(e){e.dataset.OnScrollTimerId&&(clearTimeout(e.dataset.OnScrollTimerId),delete e.dataset.OnScrollTimerId)}function X(e){const t=e.querySelector("table.dxbs-table"),o=e.classList.contains("dxbs-listbox")?e.querySelector("ul"):null;return t||o}function j(e,t,o,n,l){const i=X(t),r=function(e,t){const o=U(e);return{itemHeight:o,spacerTop:t.virtualScrollingOptions.itemsAbove*o,spacerBelow:t.virtualScrollingOptions.itemsBelow*o}}(i,l);o.style.height=r.spacerTop+"px",n.style.height=r.spacerBelow+"px",function(e,t,o,n){if(e.clientHeight>t.offsetHeight)return;e.scrollTop<o.clientHeight&&(e.scrollTop=o.clientHeight+1);e.scrollTop+e.clientHeight>o.clientHeight+t.offsetHeight&&(e.scrollTop=o.clientHeight+t.offsetHeight-e.clientHeight-1)}(t,i,o)}function U(e){const t=function(e){let t=[];return e.dataset.tempUniqueId="tempUniqueId","TABLE"===e.tagName?t=e.parentNode.querySelectorAll("TABLE[data-temp-unique-id] > TBODY > TR"):"UL"===e.tagName&&(t=e.parentNode.querySelectorAll("ul[data-temp-unique-id] > li")),delete e.dataset.tempUniqueId,t}(e),o={};for(let e=0;e<t.length;e++){const n=t[e];o[n.offsetHeight]=o[n.offsetHeight]?o[n.offsetHeight]+1:1}let n=0,l=0;for(const e in o)o[e]>l&&(l=o[e],n=e);return Number.parseInt(n)}function Y(e){return null!==X(e)}function $(e,t){let o=300,n=300;t&&(o=0,n=0);const l=X(e);let i=e.scrollTop-o;i<0&&(i=0);const r=e.scrollTop+e.clientHeight+n;let s=i-o;s<0&&(s=0);const c=r-s+n,u=U(l);return{scrollTop:i,scrollBottom:r,requestScrollState:new k(u,s,c)}}function F(e){e&&e.mainElement&&le(e.mainElement)}function K(e,t){return(t.isVerticalScrolling||t.isVirtualScrolling)&&(e.clientHeight<e.scrollHeight||"scroll"===e.style.overflowY)}function J(e){return function(){if(!e.ownerStyleSheet)return;const t=e.parentStyleSheet,o=Array.prototype.indexOf.call(t.cssRules,e);o>-1&&t.deleteRule(o)}}function Q(e){const t=e.elementsStorage,o=s(e.mainElement).parentElement;if(!o)return;const n=s(t.scrollElement),l=s(t.scrollHeaderElement),i=[],r=window.getComputedStyle(o);if(r){if(!n.style.maxHeight)if(e.isDropDown)n.style.maxHeight=ee(r,l)+"px";else{const e=a(o,e=>{n.style.maxHeight=e.height-l.offsetHeight+"px"}),t=a(l,e=>{n.style.maxHeight=o.clientHeight-(e.height+2*f(l))+"px"});i.push((function(){p(e),p(t)})),n.style.maxHeight=o.clientHeight-l.offsetHeight+"px"}if(e.isDropDown&&2!==e.dropDownWidthMode){const t=Z(n,l,o,e.mainElement,e.dropDownWidthMode,r),s=n.querySelector("table");if(!s)return;S(s,(function(){t&&t()}));const c=a(s,t=>{H(s);const i=Z(n,l,o,e.mainElement,e.dropDownWidthMode,r);S(s,(function(){i&&i()}))});i.push((function(){p(c),H(s)}))}return i.length>0?function(){i.forEach(e=>e())}:null}}function Z(e,t,n,l,i,r){function c(e,t){const o=e.querySelector(t);return o?o.children:null}let a=null;const d=e.querySelector("table"),f=t.querySelector("table");if(!d||!f)return;const p=c(d,"tbody>tr"),g=p&&1===p.length&&d.querySelector("tr.dxbs-empty-data-row"),h=c(f,"colgroup"),m=c(d,"colgroup");n.dataset.calculated&&oe(h,m);let y=0;if(g){f.style.width="auto";const e=window.getComputedStyle(f).width;f.removeAttribute("style"),y=parseFloat(e,10)}else{const e=c(f,"thead>tr");if(!(h&&e&&p&&m))return;d.style.width=f.style.width="auto";const t=[];for(let o=0;o<h.length;o++)if(h[o].style.width)if(-1!==h[o].style.width.indexOf("%"))t.push(o);else{const e=u(),t=s(l).getAttribute("data-dxdg-id");let n=null;e&&(e.insertRule("[data-dxdg-id='"+t+"'] table tr>td:nth-child("+(o+1)+"), [data-dxdg-id='"+t+"'] table tr>th:nth-child("+(o+1)+") { max-width:"+h[o].style.width+"; }",e.cssRules.length),n=e.cssRules[e.cssRules.length-1],y+=parseFloat(h[o].style.width,10)),a=J(n)}else h[o].dataset.autoWidth=!0,y+=te(h[o],m[o],e[o],p[o]);if(t.length>0)for(let o=0;o<t.length;o++)y+=te(h[o],m[o],e[o],p[o]);d.removeAttribute("style"),f.removeAttribute("style")}if(0===i||1===i){const l=o(n,"dx-blazor-multicolumn-editor");if(!l)return;const s=parseInt(r.borderRightWidth,10)+parseInt(r.borderLeftWidth,10),c=y+(e.querySelector("table").offsetHeight>ee(r,t)?b():0)+s+1;0===i&&l.offsetWidth>=c?(oe(h,m),n.style.width=l.offsetWidth+"px"):n.style.width=c+"px"}return n.dataset.calculated=!0,a}function ee(e,t){const o=parseInt(e.borderTopWidth,10)+parseInt(e.borderBottomWidth,10);return parseInt(e.maxHeight,10)-o-t.offsetHeight}function te(e,t,o,n){const l=o.offsetWidth,i=n.offsetWidth,r=l>i?l:i;return t.style.width=e.style.width=r+"px",r}function oe(e,t){for(let o=0;o<e.length;o++)if(e[o].dataset.autoWidth&&(e[o].style.width=null,t)){const e=t.item(o);e&&(e.style.width=null)}}function ne(e,t,n){const l=s(e);if(!l)return;const i=n,r=t.isMultipleSelectionEnabled,a=t.scrollToSelectedItemRequested,f=t.elementsStorage;let p=s(f.scrollElement),T=s(f.scrollHeaderElement),v=s(f.virtualScrollSpacerTopElement),I=s(f.virtualScrollSpacerBottomElement);H(l);let R=null,E=null,q=null,N=null,B=null;t.needInternalSettings&&(B=Q(t)),p=s(p);let M=null;if(p&&(T=s(T),G(p),t.isVirtualScrolling&&(v=s(v),I=s(I)),(t.isVirtualScrolling||t.isVerticalScrolling)&&function(e,t,o){if(!o.isVerticalScrolling&&!o.isVirtualScrolling)return;if(!t)return;const n=[t];if(K(e,o)){const l=17,i=b();if(i!==l||o.isHorizontalScrolling){const e=o.isHorizontalScrolling?"paddingRight":"marginRight",t=o.isHorizontalScrolling?"marginRight":"paddingRight";for(let o=0,l=n.length;o<l;o++)n[o].style[e]="0",n[o].style[t]=i+"px"}else e.style.paddingRight="",e.style.marginRight="",t.style.paddingRight="",t.style.marginRight=""}else e.style.paddingRight="0",e.style.marginRight="0",t.style.paddingRight="0",t.style.marginRight="0"}(p,T,t),t.isVirtualScrolling&&(j(0,p,v,I,t),a?A(p):p.DxRestoreScrollTop&&(p.scrollTop=p.DxRestoreScrollTop,delete p.DxRestoreScrollTop)),M=function(e){const t=e.querySelectorAll(".btn.btn-toggle");let o=0;for(let e=0;e<t.length;e++){const n=t[e],l=n.offsetWidth+c(n.parentNode);if(l>0){o=l;break}}e&&e.style.setProperty("--button-w",o+"px");const n=u(),l=e.getAttribute("data-dxdg-id");let i=null;return n&&(n.insertRule("[data-dxdg-id='"+l+"'] > col.dxbs-grid-cols-togglebtn { width:"+o+"px !important; }",n.cssRules.length),i=n.cssRules[n.cssRules.length-1]),J(i)}(l),R=function(e){return z(e,i,t,p,T,v,I)},g(p,"scroll",R),T&&g(T,"scroll",R),_(p),function(e){return!e.needInternalSettings&&(e.isHorizontalScrolling||e.isVerticalScrolling&&e.columnResizeMode!==w.Component)}(t))){const e=s(f.rootElement);E=function(){!function(e,t,o,n){let l,i;t&&(G(t),l=t.style.overflowX,t.style.overflowX="hidden",t.style.width="0"),o&&(i=o.style.overflowX,o.style.overflowX="hidden",o.style.width="0");const r=e.clientWidth;if(t&&(r&&(t.style.width=r+"px"),t.style.overflowX=l),o){const e=K(t,n)?b():0;r&&(o.style.width=r-e+"px"),o.style.overflowX=i}t&&_(t)}(e,p,T,t)},E(),g(window,"resize",E)}function C(e){!function(e){if(!r||!e.shiftKey||!m(e))return;const t=y(e);o(t,"dxbs-data-row")&&d()}(e)}g(l,"mousedown",C);let L=null,D=null;const k=t.columnResizeMode!==w.Disabled;if(t.isColumnDragEnabled){const e=l.dataset.dxdgId;e&&(L=l.querySelector("[data-dxdg-drag-head-row='"+e+"']"),L&&(q=function(t){return V(t,e,k,i)},g(L,x.touchMouseDownEventName,q)),D=l.querySelector("[data-dxdg-gp='"+e+"']"),D&&(N=function(t){return V(t,e,k,i)},g(D,x.touchMouseDownEventName,N)))}return S(l,(function(){M&&M(),B&&B(),R&&(h(p,"scroll",z),T&&h(T,"scroll",z)),E&&h(window,"resize",E),p&&O(p),q&&L&&h(L,x.touchMouseDownEventName,q),N&&D&&h(D,x.touchMouseDownEventName,N),h(l,"mousedown",C)})),Promise.resolve("ok")}function le(e){return(e=s(e))&&H(e),Promise.resolve("ok")}const ie={init:ne,dispose:le};export default ie;export{Y as HasParametersForVirtualScrollingRequest,le as dispose,$ as getParametersForVirtualScrollingRequest,ne as init,P as scrollToFocusedItem,A as scrollToSelectedItem};
