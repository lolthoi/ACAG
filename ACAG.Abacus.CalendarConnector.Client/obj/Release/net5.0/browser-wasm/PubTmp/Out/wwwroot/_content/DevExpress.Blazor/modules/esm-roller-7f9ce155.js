import"./esm-chunk-d81494b9.js";import{RequestAnimationFrame as e}from"./esm-dom-utils-c40cd314.js";import{K as t}from"./esm-chunk-808bf349.js";import{E as i,S as s,a as n}from"./esm-chunk-4bcd729b.js";function o(e){return e*(2-e)}function l(e){return e/Math.abs(e)}function r(e,t,i,s){let n=null;function o(e){return n?n(e):0}function l(){n=null}function r(e,s,o){n=function(e,t,i,s,n){const o=t+i;let l=0;return function(r,a){if(a)return a(e-l,r,s(r/o));if(r<t)return;r>=o&&n&&n();const h=e*s((Math.min(r,o)-t)/i)-l;return l+=h,h}}(s+e,o,t,i,l)}function a(e){null===n?(r(e.value,0,e.timeStamp),s(o)):n(e.timeStamp,(t,i)=>r(e.value,t,i))}return e.subscribe(a),function(){n=null,e.unsubscribe(a)}}function a(t,s,n,o,a){r(function(e,t){const s=new i;let n=0,o=1;return e.subscribe(e=>{(0===n||e.timeStamp>=n||l(e.value)!==o)&&(n=e.timeStamp+t,o=l(e.value),s.emit(e))}),s}(function(e,t,s){const n=new i;return e.addEventListener(t,e=>{e.preventDefault();const t=s(e);0===t||isNaN(t)||n.emit({value:t,timeStamp:e.timeStamp})},!1),n}(t,"wheel",e=>l(e.deltaY)*s),30),300,n,(function(t){a(new Promise((i,s)=>{!function t(i,s){e(e=>{const n=i(e);0!==n?(void 0!==n&&o(n),t(i,s)):s()})}(t,i)}))}))}function h(e,t,i){const s=i(e);return s?t||s.visible.value?s:h(s,t,i):null}function c(e,t){const i=-1===t?"prevItem":"nextItem";return e[i]?e[i]:e[i]=function(i){const s=e.value+t*i.delta;return-1===t&&-1!==i.min&&s<i.min?i.needLoop?new u(i,i.max,!1,null,e):null:1===t&&-1!==i.max&&s>i.max?i.needLoop?new u(i,i.min,!1,e,null):null:new u(i,s,!1)}(e.collection)}class m{constructor(e,t,i,n,o,l){this.collection=e,this.prevItem=o,this.nextItem=l,this.value=t,this.visible=i||new s(!0),this.selected=new s(!!n),o&&(o.nextItem=this),l&&(l.prevItem=this),this.displayText=new s(t);const r=this.collection.selectedItem;this.selected.subscribe(e=>{e&&(r.value&&r.value.selected.update(!1),r.update(this))}),this.visible.subscribe(e=>{!e&&this.selected.value&&this.getPrevious().selected.update(!0),this.collection.visibleItemsChanged.emit()},!0)}getPrevious(e){return h(this,e,e=>e.prevItem)}getNext(e){return h(this,e,e=>e.nextItem)}getDisplayText(){return this.displayText.value||this.value}}class u extends m{constructor(e,t,i,s,n){super(e,t,null,i,s,n)}getPrevious(e){return c(this,-1)}getNext(e){return c(this,1)}}class d extends u{constructor(e,t){super(e,t,!0)}}class p{constructor(e=!0){this.needLoop=e,this.items=[],this.selectedItem=new s,this.visibleItemsChanged=new i}static createCollection(e,t,i=!0){const s=new p(i);for(let i=0;i<t.length;i++)s.add(i+1,null,i+1===e).displayText.value=t[i];return s.initialize(e),s}static createGenerator(e,t,i,s,n=!0){const o=new v(t,i,s,n);return o.initialize(e),o}initialize(e){this.items.filter(t=>t.value===e)[0].selected.update(!0),this.needLoop&&(this.items[0].prevItem=this.items[this.items.length-1],this.items[this.items.length-1].nextItem=this.items[0])}add(e,t,i){const s=new m(this,e,t,i,this.items[this.items.length-1]);return this.items.push(s),s}}class v extends p{constructor(e,t,i,s){super(s),this.min=e,this.max=t,this.delta=i,this.originItem=null}initialize(e){this.originItem=new d(this,e)}}class f{constructor(e,t,i,s,n){this.displayTextSubscription=this.displayTextSubscription.bind(this),this.roller=i,this.prevItem=n,this.nextItem=null,this.index=t,this.elements=i.createRollerItemElements(),this.offset=t*s,this.height=s,this.position=0,this.visibleItemCount=i.visibleItemCount,n&&(n.nextItem=this),this.updateDataItem(e),this.selectItem=this.selectItem.bind(this)}initialize(t){const i=Math.floor(this.visibleItemCount/2);this.elements[1].style.top=(this.index-i)*this.height+"px",t.appendChild(this.elements[1]),this.move(this.offset),this.elements[0].addEventListener("click",t=>{e(this.selectItem)})}isSelected(){return Math.floor(this.visibleItemCount/2)*this.height===Math.round(this.position)}selectItem(t){if(!this.dataItem)return;const i=Math.floor(this.visibleItemCount/2);return this.roller.afterMove(x(n.Empty,e=>this.roller.move(e),{divisor:this.roller.itemSize.height,startTimestamp:t,endTimestamp:t+300,easing:o,frameCallback:e,value:(i-this.index)*this.height-(this.position-this.offset)}))}move(e){this.updatePosition(e);const t=this.position-this.offset;this.elements.forEach(e=>e.style.transform="matrix(1, 0, 0, 1, 0, "+t+")")}updatePosition(e){this.position+=e,this.position>this.visibleItemCount*this.height?(this.position-=(this.visibleItemCount+1)*this.height,this.updateDataItem(this.nextItem.dataItem?this.nextItem.dataItem.getPrevious():null)):this.position<-1*this.height&&(this.position+=(this.visibleItemCount+1)*this.height,this.updateDataItem(this.prevItem.dataItem?this.prevItem.dataItem.getNext():null))}updateDataItem(e){this.dataItem!==e&&(this.dataItem&&this.dataItem.displayText.unsubscribe(this.displayTextSubscription),this.dataItem=e,this.dataItem?this.dataItem.displayText.subscribe(this.displayTextSubscription):this.displayTextSubscription(""))}displayTextSubscription(e){this.elements.forEach(t=>g(t,e))}raiseChanges(){this.isSelected()&&this.dataItem.selected.update(!0)}}function g(e,t){e.innerText=t}function b(e,t,i){const s=i(e);return Math.abs(Math.round(s.position-e.position))===t?[s].concat(b(s,t,i)):[]}function C(e,t,i){0!==e.length&&(e.shift().updateDataItem(t),C(e,i(t),i))}class I{constructor(e,t,i,s,n,o){this.itemCollection=e,this.visibleItemCount=t,this.itemContainers=[],this.itemSize=s,this.caption=n,this.longestVisibleDisplayText=o,this.needLoop=e.needLoop,this.container=i,this.rollerElement=null,this.rollerContainer=null,this.move=this.move.bind(this),this.moveReversed=this.moveReversed.bind(this),this.afterMove=this.afterMove.bind(this)}initialize(){this.initializeRollerElements();const s=[this.itemCollection.selectedItem.value];for(;s.length<this.visibleItemCount;)s.splice(0,0,s[0]?s[0].getPrevious():null),s.push(s[s.length-1]?s[s.length-1].getNext():null);s.push(s[s.length-1]?s[s.length-1].getNext():null);for(let e=0;e<s.length;e++)this.itemContainers.push(new f(s[e],e,this,this.itemSize.height,this.itemContainers[this.itemContainers.length-1]));this.longestVisibleDisplayText&&g(this.createRollerItemElement("roller-item expander"),this.longestVisibleDisplayText);const n=this.createRollerItemElement("roller-after");this.itemContainers[0].prevItem=this.itemContainers[this.itemContainers.length-1],this.itemContainers[this.itemContainers.length-1].nextItem=this.itemContainers[0];for(let e=0;e<this.itemContainers.length;e++)this.itemContainers[e].initialize(n);this.itemCollection.selectedItem.subscribe(()=>this.updateVisibleDataItems(),!0),this.itemCollection.visibleItemsChanged.subscribe(()=>this.updateVisibleDataItems(),!0),a(this.rollerElement,this.itemSize.height,o,this.moveReversed,this.afterMove),function(t,s,n,o){const l=new i,r=new i;let a=0;t.addEventListener("touchstart",(function(e){a=e.touches[0].clientY}),!1),t.addEventListener("touchend",(function(t){a=0,e(e=>r.emit(e))}),!1),t.addEventListener("touchmove",(function(e){e.preventDefault();const t=e.changedTouches[0].clientY;l.emit(t-a),a=t}),!1),w(l,r,{divisor:s},n,o,e)}(this.rollerElement,this.itemSize.height,this.move,this.afterMove),this.rollerContainer.addEventListener("keydown",e=>{let i=null;e.keyCode===t.Up?i=this.itemCollection.selectedItem.value.getPrevious():e.keyCode===t.Down&&(i=this.itemCollection.selectedItem.value.getNext()),i&&(e.preventDefault(),i.selected.update(!0))})}initializeRollerElements(){const e=this.rollerContainer=document.createElement("SPAN");e.className="roller-container",e.style.minWidth=this.itemSize.width;const t=document.createElement("SPAN");t.innerText=this.caption,t.className="roller-title",e.appendChild(t);const i=this.rollerElement=document.createElement("A");i.href="javascript:;",i.className="roller",i.style.height=this.itemSize.height*this.visibleItemCount+"px",e.appendChild(i),this.container&&this.container.appendChild(e)}updateVisibleDataItems(){const e=this.itemContainers.filter(e=>e.isSelected())[0];if(!e)return;const t=b(e,this.itemSize.height,e=>e.prevItem),i=b(e,this.itemSize.height,e=>e.nextItem),s=this.itemCollection.selectedItem.value;e.updateDataItem(s),C(t.concat([]),s.getPrevious(),e=>e?e.getPrevious():null),C(i.concat([]),s.getNext(),e=>e?e.getNext():null)}createRollerItemElement(e){const t=document.createElement("SPAN");return t.className=e||"roller-item",this.rollerElement.appendChild(t),t}createRollerItemElements(){const e=this.createRollerItemElement();return[e,e.cloneNode()]}moveReversed(e){this.move(0-e)}move(e){if(0===e)return;const t=Math.sign(e),i=this.itemContainers.length-1,s=-1===t?i:0,n=(-1===t?0:i)+t;if(!this.needLoop){if(1===t){const i=Math.floor(this.visibleItemCount/2)*this.itemSize.height;for(let o=s;o!==n;o+=t)!this.itemContainers[o].dataItem&&this.itemContainers[o].position+this.itemSize.height-i<=0&&this.itemContainers[o].position+this.itemSize.height+e-i>0&&(e=Math.min(i-(this.itemContainers[o].position+this.itemSize.height),e))}else{const i=(Math.floor(this.visibleItemCount/2)+1)*this.itemSize.height;for(let o=s;o!==n;o+=t)!this.itemContainers[o].dataItem&&this.itemContainers[o].position-i>=0&&this.itemContainers[o].position+e-i<0&&(e=Math.max(i-this.itemContainers[o].position,e))}if(0===e)return}for(let i=s;i!==n;i+=t)this.itemContainers[i].move(e)}afterMove(e){return e.then(()=>Promise.resolve(this.itemContainers.forEach(e=>e.raiseChanges())))}}function x(e,t,i){return new Promise((s,n)=>{function o(){e.unsubscribe(o),n()}e.subscribe(o,!0);let l=0;const r=i.frameCallback;r((function n(a){if(a<i.endTimestamp){const e=i.easing((a-i.startTimestamp)/(i.endTimestamp-i.startTimestamp)),s=i.value*e-l;t(s),l+=s,r(n)}else e.unsubscribe(o),t(i.value-l),s()}))})}function w(e,t,i,s,n,l){let r,a,h,c,m=1;const u=i.accelerationTimeFrame||300;function d(e){a=0,h=e,m=1}e.subscribe((function(p){l(v=>{c||(c=!0,d(v),n(new Promise((n,r)=>{t.subscribe((function r(h){t.unsubscribe(r),x(e,s,function(e){const t=Math.abs(a%i.divisor);return{value:(i.divisor-t)*Math.sign(a),endTimestamp:e+300,startTimestamp:e,easing:o,frameCallback:l}}(h)).then(()=>{c=!1,n()}).catch(()=>{t.subscribe(r)}).finally(d)}))}))),s(function(e,t){return(t*=m)>=r&&e-h<=u&&(m=Math.min(2,1.2*m)),a+=t,r=t,h=e,t}(v,p))})}))}function y(e){return e.value%4==0&&e.value%100!=0||e.value%400==0}function z(e){return 2!==e.value}function S(e){return-1!==[1,3,5,7,8,10,12].indexOf(e.value)}const M=0,T=1,E=2,D=3,N=4,P=5;function k(e,t,i,s,n,o){const l=e.add(t,i,s);n.length>0&&o.subscribe(([e,i])=>{const s=n[L(i.value,e.value,t)];l.displayText.update(t+" "+s)})}function L(e,t,i){return new Date(e,t-1,i).getDay()}function R(e){return e&&e.length?" "+e.concat([]).sort((e,t)=>t.length-e.length)[0]:""}const A=1,j=2,G=0,V=1,Y=2,F=3;function U(e,t,i){if(!t)return;const s=t.time;if(!s)return;const n=t.twelveHourFormat;let o=n?s.hours%12:s.hours;n&&0===o&&(o=12);let l=s.minutes,r=s.seconds,a=s.hours>=12?j:A;const h=p.createGenerator(r,0,59,1),c=p.createGenerator(l,0,59,1),m=n?p.createGenerator(o,1,12,1):p.createGenerator(o,0,23,1);let u=null;t.ampmDesignators&&t.ampmDesignators[0]&&t.ampmDesignators[1]&&(u=p.createCollection(a,t.ampmDesignators,!1));const d=document.createDocumentFragment(),v=document.createElement("STYLE");function f(e){return function(t){e(t),i.invokeMethodAsync("UpdateDateTime",[o,l,r,a])}}return v.type="text/css",v.innerText=".roller { height: 180px; } .roller-item, .roller-after { height: 36px; } .roller-item, .roller-title { color: "+window.getComputedStyle(e).color+" !important; } .roller-after { background-color: "+window.getComputedStyle(e.parentNode.parentNode).backgroundColor+";}",d.appendChild(v),t.items.forEach(e=>{switch(e.type){case G:new I(m,5,d,{width:"",height:36},"Hour","15").initialize();break;case V:new I(c,5,d,{width:"",height:36},"Minute","55").initialize();break;case Y:new I(h,5,d,{width:"",height:36},"Second","55").initialize();break;case F:if(u){new I(u,5,d,{width:"",height:36},"AM/PM","AM").initialize()}}}),m.selectedItem.subscribe(f(e=>{o=e.value})),c.selectedItem.subscribe(f(e=>{l=e.value})),h.selectedItem.subscribe(f(e=>{r=e.value})),u&&u.selectedItem.subscribe(f(e=>{a=e.value})),H.set(e,new W(m,c,h,u)),e.appendChild(d),Promise.resolve()}const H=new WeakMap;class W{constructor(e,t,i,s){this.hoursCollection=e,this.minutesCollection=t,this.secondsCollection=i,this.AMPMCollection=s}update(e){if(this.AMPMCollection){let t=this.AMPMCollection?e.hours%12:e.hours;t=0===t?12:t,this.hoursCollection.initialize(t),this.AMPMCollection.initialize(e.hours>=12?j:A)}else this.hoursCollection.initialize(e.hours);this.minutesCollection.initialize(e.minutes),this.secondsCollection.initialize(e.seconds)}}class K{constructor(e,t,i){this.yearsCollection=e,this.monthsCollection=t,this.daysCollection=i}update(e){const t=e.filter(e=>e.type===T||e.type===E||e.type===M)[0],i=e.filter(e=>e.type===D||e.type===N)[0],s=e.filter(e=>e.type===P)[0];this.yearsCollection.initialize(s.value),this.monthsCollection.initialize(i.value),this.daysCollection.initialize(t.value)}}function O(e,t){H.has(e)&&H.get(e).update(t)}const q={initializeDateRoller:function(e,t,i,s,n){let o=t.items.filter(e=>e.type===T||e.type===E||e.type===M)[0],l=t.items.filter(e=>e.type===D||e.type===N)[0],r=t.items.filter(e=>e.type===P)[0],a=t.monthNames||[];const h=t.dayNames||[];o=void 0!==o?o.value:1,void 0===l?(a=["","","","","","","","","","","",""],l=i):l=l.value,r=void 0===r?s:r.value;const c=p.createGenerator(r,-1,-1,1),m=p.createCollection(l,a),u=m.selectedItem.asTrigger(z),d={29:c.selectedItem.asTrigger(y).or(u),30:u,31:m.selectedItem.asTrigger(S)},v=m.selectedItem.join(c.selectedItem),f=new p;for(let e=1;e<=31;e++)k(f,e,d[e],e===o,h,v);f.initialize(o);const g=["25"+R(h),R(a),"0000"].reduce((e,t)=>e.length>t.length?e:t),b=document.createDocumentFragment(),C=document.createElement("STYLE");function x(e){return function(t){e(t),n.invokeMethodAsync("UpdateDateTime",[o,l,r])}}return C.type="text/css",C.innerText=".roller { height: 180px; } .roller-item, .roller-after { height: 36px; } .roller-item, .roller-title { color: "+window.getComputedStyle(e).color+" !important; } .roller-after { background-color: "+window.getComputedStyle(e.parentNode.parentNode).backgroundColor+";}",b.appendChild(C),t.items.forEach(e=>{switch(e.type){case M:case E:case T:new I(f,5,b,{width:"",height:36},"Day",g).initialize();break;case N:case D:new I(m,5,b,{width:"",height:36},"Month",g).initialize();break;case P:new I(c,5,b,{width:"",height:36},"Year",g).initialize()}}),e.appendChild(b),f.selectedItem.subscribe(x(e=>{o=e.value})),m.selectedItem.subscribe(x(e=>{l=e.value})),c.selectedItem.subscribe(x(e=>{r=e.value})),H.set(e,new K(c,m,f)),Promise.resolve()},initializeTimeRoller:U,updateRoller:O};export default q;export{I as Roller,m as RollerItem,p as RollerItemCollection,w as attachInputSource,L as getDayOfWeek,U as initializeTimeRoller,O as updateRoller};
