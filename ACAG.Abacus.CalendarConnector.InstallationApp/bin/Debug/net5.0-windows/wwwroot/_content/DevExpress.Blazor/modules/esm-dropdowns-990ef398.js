import"./esm-chunk-d81494b9.js";import{changeDom as t,ensureElement as e,getParentByClassName as n,addClassNameToElement as o,RequestAnimationFrame as i,elementIsInDOM as s}from"./esm-dom-utils-c40cd314.js";import{a as r,d as c}from"./esm-chunk-9c16a801.js";import{d as l,r as u}from"./esm-chunk-f3c18c5b.js";import{T as a}from"./esm-chunk-1b6abd73.js";import{K as d}from"./esm-chunk-808bf349.js";import"./esm-chunk-13e2cf5f.js";import{scrollToFocusedItem as h}from"./esm-grid-1b060bef.js";import"./esm-grid-column-resize-adeb3acf.js";import{show as f,getElementPaddingRight as m,getScrollbarWidth as p}from"./esm-popup-utils-32033e18.js";import{initFocusHidingEvents as g}from"./esm-focus-utils-c767d78c.js";import{E as v}from"./esm-chunk-d4fc448c.js";import{getClientRectWithMargins as w,getClientRect as b,PointBlz as y,geometry as E}from"./esm-dragAndDropUnit-f02dc664.js";const C=document.body,x=new window.WeakMap,S=new Map,P={subtree:!0,childList:!0},D=new window.MutationObserver((function(t){t.forEach(M)}));function M(t){t.removedNodes.forEach(L)}function L(t){const e=S.get(t);S.delete(t)&&(0===S.size&&D.disconnect(),e())}class T{constructor(t,e){this.element=t,this.getClientRect=e}get leftTopCorner(){const t=this;return new R(this.element,(function(e){return t.getClientRect(e)}),(function(t){return{x:0,y:0}}))}get leftBottomCorner(){const t=this;return new R(this.element,(function(e){const n=t.getClientRect(e);return new y(n.x,n.bottom)}),(function(e){const n=t.getClientRect(e);return new y(0,-n.height)}))}get rightTopCorner(){const t=this;return new R(this.element,(function(e){const n=t.getClientRect(e);return new y(n.right,n.y)}),(function(e){const n=t.getClientRect(e);return new y(n.width,0)}))}get rightBottomCorner(){const t=this;return new R(this.element,(function(e){const n=t.getClientRect(e);return new y(n.right,n.bottom)}),(function(e){const n=t.getClientRect(e);return new y(n.width,-n.height)}))}get center(){const t=this;return new R(this.element,(function(e){return t.getClientRect(e).center}))}}class R{constructor(t,e,n){this.element=t,this.getLocation=e,this.getDelta=n}get location(){return this.getLocation(this.element)}get delta(){return this.getDelta(this.element)}anchorTo(t){return new O(this,t)}}class O{constructor(t,e){this.point=t,this.anchor=e,this.events=new v(this);const n=[];if(n.push([window,"resize"]),n.push([window,"scroll"]),this.containers=function(t,e){const n=[];for(;null!==t&&"BODY"!==t.tagName&&"#document"!==t.nodeName;)e(t)&&n.push(t),t=t.parentNode;return 0===n.length?null:n}(this.anchor.element.parentNode,this.isElementScrollable),this.containers&&this.containers.forEach((function(t){n.push([t,"scroll"])})),this.checkInCasesInt(n),"undefined"!=typeof ResizeObserver){const t=this;this.resizeObserver=new window.ResizeObserver((function(){t.update()})),this.resizeObserver.observe(this.anchor.element),this.resizeObserver.observe(this.point.element)}else this.resizeObserver=null;this.notStaticParent=this.point.element.offsetParent,this.notStaticParent=this.isStatic(this.notStaticParent)?document.documentElement:this.notStaticParent,this.notStaticParent=null!==this.notStaticParent?this.notStaticParent:{x:0,y:0,scrollTop:0,scrollLeft:0},this.update()}isElementScrollable(t){const e=window.getComputedStyle(t);return"static"===e.position&&("scroll"===e["overflow-x"]||"scroll"===e["overflow-y"]||"auto"===e["overflow-x"]||"auto"===e["overflow-y"])}isStatic(t){return"static"===window.getComputedStyle(t).position}update(){const e=E(this.anchor.location,"+",this.point.delta,"-",this.notStaticParent,"+",{x:this.notStaticParent.scrollLeft,y:this.notStaticParent.scrollTop}),n=this.point.element;t((function(){n.style.left=e.x+"px",n.style.top=e.y+"px"}))}checkInCasesInt(t){const e=this.events;t.forEach((function(t){e.attachEvent(t[0],t[1],(function(t){this.update()}))}))}checkInCases(){return this.containers?(this.checkInCasesInt(Array.from(arguments)),this.update(),this):this}dispose(){this.events&&(this.events.dispose(),this.events=null,this.dropDownStartPos=null,this.containers=null,this.resizeObserver&&this.resizeObserver.disconnect())}}function k(t){return new T(t,w)}function z(t){return new T(t,b)}const N={Popup:0,Modal:1},H=1,B=2,I=new WeakMap;let j;function W(t){let n=(t=e(t)).querySelector("div.dxbs-dm.dropdown-menu");return n||(n=t.querySelector("div.dxgvCSD.dxbs-grid-vsd")),n}function q(t,n,o,i){return new Promise((function(o,s){let r=W(t);return r=e(r),r?(0===i&&(r.style.minWidth=t.offsetWidth+"px"),2===i&&(r.style.width=t.offsetWidth+"px"),F(t,r,n),h(r),o()):o()}))}function F(e,n,o,i){I.has(e)&&(I.get(e).disconnect(),I.delete(e));const s=n.offsetParent;if(!s)return t((function(){n.style.visibility=""})),void 0;const r=s.getBoundingClientRect(),c=e.getBoundingClientRect(),l=c.top-r.top,u=r.bottom-c.bottom;let a;const d=window.getComputedStyle(n),h=n.offsetHeight+Math.max(parseFloat(d.marginTop),0)+Math.max(parseFloat(d.marginBottom),0)+8;switch(o){case B:a=!0,r.top+(l-h)<=0&&r.top+l+e.offsetHeight+h+window.pageYOffset<=Math.max(document.body.scrollHeight,window.innerHeight)&&(a=!1);break;case H:default:a=!1,r.bottom-(u-h)>=window.innerHeight&&r.top+l-h+window.pageYOffset>=0&&(a=!0)}t((function(){j&&j.dispose(),j=a?k(n).leftBottomCorner.anchorTo(z(e).leftTopCorner):k(n).leftTopCorner.anchorTo(z(e).leftBottomCorner),n.style.visibility=""}))}const A=[{value:0,text:""},{value:1,text:"above"},{value:2,text:"below"},{value:4,text:"top-sides"},{value:8,text:"bottom-sides"},{value:16,text:"outside-left"},{value:32,text:"outside-right"},{value:64,text:"left-sides"},{value:128,text:"right-sides"}];function Y(t,e,n){let o=t.target;for(;o;){if(o===e)return!1;o=o.parentElement}n&&n()}function _(t){return"hidden"!==t.style.visibility||t.classList.contains("visually-hidden")}const G="a[href], input:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex='-1'])";function U(t,e){if(n(t.srcElement,"modal-header"))return!0;const o=n(t.srcElement,"column-chooser-elements-container"),i=n(o,"modal-body");if(!o||!i)return!1;if(i.clientHeight>=o.clientHeight)return!0;const s=t.touches[0].pageY-e.touches[0].pageY,r=function(t){return t.getBoundingClientRect().top},c=o.querySelector(".column-chooser-element-container");if(c&&r(c)===r(i)&&s>=0&&t.cancelable)return!0;const l=function(t){return Math.round(t.getBoundingClientRect().bottom)},u=o.querySelector(".column-chooser-element-container:last-child");return!!(u&&l(u)===l(i)&&s<=0&&t.cancelable)||void 0}function V(t,e,o){if(o!==N.Modal)return;const i=t.getBoundingClientRect(),s=e.getBoundingClientRect(),r=n(t,"dxbs-gridview"),c=r&&r.querySelector("thead");if(!c)return;const l=c.getBoundingClientRect(),u=(l||i).bottom;return u>.5*e.clientHeight?u-i.top<.5*e.clientHeight?u-s.top-.5*e.clientHeight:i.top-s.top-2:void 0}function K(t){const e=t.getElementsByClassName("modal-body")[0];e.style.width=e.offsetWidth+"px",e.style.height=e.offsetHeight+"px"}const J={init:function(t,n,o,i){if(t=e(t),n=e(n),o=e(o),t){if(l(t),o){const e=function(e){return Y(e,t,(function(){s(t)||l(t);const e=document.activeElement===n,r=o&&_(o);(e||r)&&i.invokeMethodAsync("OnDropDownLostFocus",n.value)}))};r(document,a.touchMouseDownEventName,e),u(t,(function(){c(document,a.touchMouseDownEventName,e)}))}return Promise.resolve("ok")}},dispose:function(t){return(t=e(t))&&l(t),j&&j.dispose(),Promise.resolve("ok")},showAdaptiveDropdown:function(s,r,c,l,u){s=e(s);const h=n(s,c);if(!h)return;const v=document.documentElement,w=document.documentElement.style.overflow,b=document.body.style.overflow,y=document.body.scroll,E=r.dialogType,M=r.alignment,L=E===N.Modal;E===N.Popup?0===M?F(h,s,r.dropDownDirection):f(s,h,function(t){let e="";return A.forEach(n=>{0!=(n.value&t)&&(e&&(e+=" "),e+=n.text)}),e}(M)):(s.style.paddingRight=m(s)+p()+"px",document.body.style.paddingRight=parseFloat(m(document.body))+p(),document.body.classList.add("modal-open"));let T=!1;function R(t){(!s.contains(t.srcElement)||E===N.Modal&&s===t.srcElement)&&k()}function O(t){v.removeEventListener("focusin",O),null===t.relatedTarget&&t.target&&s&&s.contains(t.target)&&t.target.focus()}function k(){T||(T=!0,setTimeout((function(){s&&(z(),u.invokeMethodAsync("CloseDialog"))}),200))}function z(){v.removeEventListener(a.touchMouseDownEventName,R),window.removeEventListener("resize",B),I(E,!1)}function H(){const t=s.querySelector(G);t&&t.focus()}function B(){if(!n(s,"modal-dialog-owner"))return;const t=s.firstElementChild.classList,e=V(h,v,E),o=v.clientHeight>v.clientWidth?"topVertical":"topHorizontal";i((function(){t.contains("topVertical")||t.contains("topHorizontal")?t.remove("transition"):t.add("transition"),e&&(v.scrollTop=e),t.remove("topVertical","topHorizontal"),t.add(o)}))}function I(t,e){if(t!==N.Modal)return;let n,o,i;e?(n="hidden",o="hidden",i="no"):(n=w,o=b,i=y),document.documentElement.style.overflow=n,document.body.style.overflow=o,document.body.scroll=i}return v.addEventListener(a.touchMouseDownEventName,R),s.addEventListener("keydown",(function(t){t.keyCode===d.Esc&&k()})),s.addEventListener("focusout",(function(t){T||(null===t.relatedTarget||s.contains(t.relatedTarget)?null===t.relatedTarget&&v.addEventListener("focusin",O):!function(t){const e=s.compareDocumentPosition(t);e&window.Node.DOCUMENT_POSITION_PRECEDING?!function(){const t=function(t){const e=t.querySelectorAll(G);return e[e.length-1]}(s);t&&t.focus()}():e&window.Node.DOCUMENT_POSITION_FOLLOWING&&H()}(t.relatedTarget))})),function(t,e,n,o){t&&e.addEventListener("touchmove",t=>{t.srcElement===e&&t.preventDefault()});if(o===N.Modal){let t=null;n.addEventListener("touchstart",e=>{t=e}),n.addEventListener("touchmove",e=>{U(e,t)&&e.preventDefault(),t=e})}}(L,s,h,E),function(t){if(x.has(t))return x.get(t);const e=new Promise((function(e){0===S.size&&D.observe(C,P);S.set(t,()=>{t=null,e()})}));return x.set(t,e),e}(s).then(()=>{E===N.Modal&&(document.body.classList.remove("modal-open"),document.body.style.paddingRight=parseFloat(m(document.body))-p()),z(),s=null}),I(E,!0),E===N.Popup?t((function(){s&&(r.showFocus||(o(s,"dxbs-focus-hidden"),g(s)),H())})):(window.addEventListener("resize",B),B()),Promise.resolve()},updateGridDropDown:q,setInlineModalSize:K};export default J;export{N as DialogType,W as getDropDownElement,_ as isDropDownVisible,Y as onOutsideClick,V as scrollDropDown,K as setInlineModalSize,F as setPositionOfDropDown,U as shouldPreventTouchMove,q as updateGridDropDown};
